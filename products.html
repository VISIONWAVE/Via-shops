<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Products | VisionWave</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="shortcut icon" href="assets/images/favicon.ico" />
</head>

<body class="dark-mode">
  <!-- ‚îÄ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <header class="top-bar">
    <h1>üõçÔ∏è Products</h1>

    <div class="filter-bar">
      <input id="searchBox" class="search-input" type="text" placeholder="Search products‚Ä¶" />
      <select id="catFilter" class="cat-select">
        <option value="">All Categories</option>
      </select>
      <a href="cart.html" class="btn-primary">üõí Cart (<span id="cartCount">0</span>)</a>
    </div>
  </header>

  <!-- ‚îÄ‚îÄ‚îÄ PRODUCT GRID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main>
    <section id="grid" class="product-grid"></section>
  </main>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE-SPECIFIC JS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    const grid = document.getElementById('grid');
    const searchBox = document.getElementById('searchBox');
    const catFilter = document.getElementById('catFilter');
    const cartCountElement = document.getElementById('cartCount');
    let allProducts = [];

    // Fetch products from backend
    async function fetchProducts() {
      try {
        const response = await fetch('backend/product/get-products.php');
        allProducts = await response.json();
        renderProducts(allProducts);
        populateCategories(allProducts);
      } catch (error) {
        grid.innerHTML = '<p class="error-message">‚ö†Ô∏è Could not load products.</p>';
      }
    }

    // Render product cards
    function renderProducts(products) {
      if (!products.length) {
        grid.innerHTML = '<p class="no-results">No products found.</p>';
        return;
      }

      grid.innerHTML = products.map(product => `
        <div class="card" data-name="${product.name.toLowerCase()}" data-cat="${product.category}">
          <a href="product-details.html?id=${product.id}">
            <img src="assets/images/${encodeURIComponent(product.image)}" alt="${product.name}" />
            <h3>${product.name}</h3>
          </a>
          <p class="price">‚Ç¶${parseFloat(product.price).toLocaleString()}</p>
          <button onclick="addToCart(${product.id})">Add to Cart</button>
        </div>
      `).join('');
    }

    // Populate category dropdown
    function populateCategories(products) {
      const categories = [...new Set(products.map(p => p.category))].sort();
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        catFilter.appendChild(option);
      });
    }

    // Filter products by search or category
    function filterProducts() {
      const searchTerm = searchBox.value.toLowerCase();
      const selectedCategory = catFilter.value;
      const filtered = allProducts.filter(p => {
        return p.name.toLowerCase().includes(searchTerm) && (!selectedCategory || p.category === selectedCategory);
      });
      renderProducts(filtered);
    }

    // Add product to cart
    function addToCart(productId) {
      try {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const product = allProducts.find(p => p.id == productId);
        
        if (!product) return;

        const existingItem = cart.find(item => item.id == productId);
        
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({
            id: product.id,
            name: product.name,
            price: product.price,
            image: product.image,
            quantity: 1
          });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        alert(`‚úÖ ${product.name} added to cart!`);
      } catch (error) {
        console.error('Error adding to cart:', error);
        alert('‚ùå Failed to add product to cart');
      }
    }

    // Update cart count in UI
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const count = cart.reduce((total, item) => total + item.quantity, 0);
      cartCountElement.textContent = count;
    }

    // Initialize
    searchBox.addEventListener('input', filterProducts);
    catFilter.addEventListener('change', filterProducts);
    fetchProducts();
    updateCartCount();
  </script>
</body>
</html>